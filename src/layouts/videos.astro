---
import "../styles/videos.css";
import Button from "../components/button.astro";
import VideoItem from "../components/videoItem.astro";
---

<div class="videosSection" id="videosSection">
  <div class="headerSection">
    <p>
      Ekido spesialis konten pendek (Short-form) untuk TikTok/Instagram Reels,
      cocok untuk akun Brand atau Personal-mu.
    </p>
  </div>

  <section class="splide" id="videosSplide">
    <div class="splide__arrows">
      <button class="splide__arrow splide__arrow--prev">
        <div class="arrowRight">
          <svg
            width="7"
            height="11"
            viewBox="0 0 7 11"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M0 2.11803C0 1.37465 0.782313 0.891156 1.44721 1.22361L8.21114 4.60557C8.94819 4.9741 8.94819 6.0259 8.21115 6.39443L1.44722 9.77639C0.782315 10.1088 0 9.62535 0 8.88197V2.11803Z"
              fill="#5150E3"></path>
          </svg>
        </div>
      </button>
      <button class="splide__arrow splide__arrow--next">
        <div class="arrowRight">
          <svg
            width="7"
            height="11"
            viewBox="0 0 7 11"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M0 2.11803C0 1.37465 0.782313 0.891156 1.44721 1.22361L8.21114 4.60557C8.94819 4.9741 8.94819 6.0259 8.21115 6.39443L1.44722 9.77639C0.782315 10.1088 0 9.62535 0 8.88197V2.11803Z"
              fill="#5150E3"></path>
          </svg>
        </div>
      </button>
    </div>

    <div class="splide__track">
      <ul class="splide__list">
        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/l_Ekido:wmlogo,w_450,o_70,g_center/f_auto,q_auto/v1753280576/Ekido/asamlambunk.mp4"
            username="@asamlambunk"
            views="54,2K"
            description="Content Plan + Script + Video Editing"
          />
        </li>
        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/f_auto,q_auto/v1753413524/Ekido/doddy.prayogo_2_kvjg4l.mov"
            username="@doddy.prayogo"
            views="31,1K"
            description="Video Editing"
          />
        </li>

        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/l_Ekido:wmlogo,w_450,o_70,g_center/f_auto,q_auto/v1753281750/Ekido/merryclestari_sg5xzw.mp4"
            username="@merryclestari"
            views="291K"
            description="Scriptwriting + Video Editing"
          />
        </li>
        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/f_auto,q_auto/v1753289305/Ekido/jason_f065xa.mov"
            username="@jsnnath"
            views="1M"
            description="Video Editing"
          />
        </li>

        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/l_Ekido:wmlogo,w_700,o_70,g_center/f_auto,q_auto/v1753281787/Ekido/romario_rage_p1f72q.mp4"
            username="@romario_rage"
            views="21,6M"
            description="Content Plan + Video Editing"
          />
        </li>
        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/f_auto,q_auto/v1753289307/Ekido/albert_zif8eb.mov"
            username="@bangalbert.id"
            views="1M"
            description="Video Editing"
          />
        </li>

        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/l_Ekido:wmlogo,w_450,o_70,g_center/f_auto,q_auto/v1753281818/Ekido/varuuyy_yqx2kp.mp4"
            username="@varuuyy"
            views="37,8M"
            description="Scriptwriting + Video Editing"
          />
        </li>
        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/f_auto,q_auto/v1753413577/Ekido/hendrikogani_2_nnkxzq.mov"
            username="@hendrikogani"
            views="7,252"
            description="Video Editing"
          />
        </li>

        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/f_auto,q_auto/v1753414618/Ekido/tantedianny_ouojre.mov"
            username="@dianypranata"
            views="500K"
            description="Video Editing"
          />
        </li>
        <li class="splide__slide">
          <VideoItem
            src="https://res.cloudinary.com/sinemaxpekat/video/upload/f_auto,q_auto/v1753414596/Ekido/kaizen_rbp4nb.mov"
            username="@kaizenbarbershop"
            views="20K"
            description="Video Editing"
          />
        </li>
      </ul>
    </div>
  </section>

  <div class="footerSection">
    <Button href="http://wa.link/2d3uae" color="blue">Pesan Sekarang</Button>
    <p>Geser ke bawah untuk lihat jasa & portfolio kami â†“</p>
  </div>
  <img src="/asset1.svg" alt="asset1" class="asset1alt" />
  <img src="/asset2.svg" alt="asset2" class="asset2" />
</div>

<script>
  import Splide from "@splidejs/splide";

  document.addEventListener("DOMContentLoaded", function () {
    const splide = new Splide("#videosSplide", {
      autoplay: true,
      type: "loop",
      perPage: 4,
      perMove: 1,
      gap: "16px",
      pagination: false,
      breakpoints: {
        1024: {
          perPage: 4,
        },
        768: {
          perPage: 3,
        },
        480: {
          perPage: 1,
        },
      },
    });

    const videoStates = new WeakMap();

    splide.on("mounted move", () => {
      const slides = document.querySelectorAll("#videosSplide .splide__slide");
      const activeIndex = splide.index;

      slides.forEach((slide, index) => {
        const video = slide.querySelector(".portfolio-video");
        if (!video) return;

        const state = videoStates.get(video) || { interacted: false };

        if (index === activeIndex && state.interacted) {
          (video as HTMLVideoElement).play();
        } else {
          (video as HTMLVideoElement).pause();
        }
      });
    });

    document.querySelectorAll(".portfolio-video").forEach((video) => {
      videoStates.set(video, { interacted: false });

      video.addEventListener("mouseenter", () => {
        (video as HTMLVideoElement).play();
      });

      video.addEventListener("mouseleave", () => {
        const state = videoStates.get(video);
        if (!state.interacted) {
          state.interacted = true;
          (video as HTMLVideoElement).loop = true;
          videoStates.set(video, state);
        }
      });
    });

    splide.mount();
  });
</script>
