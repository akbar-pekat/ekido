---
import "../../styles/blogContent.css";
import Base from "../../layouts/base.astro";
import Navbar from "../../layouts/navbar.astro";
import About from "../../layouts/about.astro";
import Footer from "../../layouts/footer.astro";
import JsonLd from "../../components/JsonLd.astro";

import { getAllPosts, getPost } from "../../lib/client";

export async function getStaticPaths() {
  const data = await getAllPosts();
  const allPosts = data.publication.posts.edges;
  return allPosts.map((post) => {
    return {
      params: { slug: post.node.slug },
    };
  });
}
const { slug } = Astro.params;
const post = await getPost(slug);

// Format tanggal dari ISO ke format yang lebih mudah dibaca
function formatDate(isoDate: string) {
  const date = new Date(isoDate);
  const day = date.getDate();
  const monthNames = [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "Mei",
    "Jun",
    "Jul",
    "Agu",
    "Sep",
    "Okt",
    "Nov",
    "Des",
  ];
  const month = monthNames[date.getMonth()];
  const year = date.getFullYear();
  return `${day} ${month} ${year}`;
}

const formattedDate = post.publishedAt ? formatDate(post.publishedAt) : "";

// Prepare SEO metadata
const title = `${post.title} | Ekido Blog`;
const description = post.subtitle || post.brief;
const keywords = post.tags
  ? post.tags.map((tag) => tag.name).join(", ")
  : "ekido, blog, artikel";
const ogImage =
  post.coverImage?.url ||
  "https://res.cloudinary.com/apclient/image/upload/v1753514918/ogimage_fphgur.png";
const canonicalUrl = new URL(
  `/blog/${slug}`,
  Astro.site || "https://ekidocreative.com"
).toString();

// Buat data JSON-LD untuk blog post
const jsonLdData = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: post.title,
  description: post.subtitle || post.brief,
  image: post.coverImage?.url,
  datePublished: post.publishedAt,
  author: {
    "@type": "Person",
    name: post.author.name,
  },
  publisher: {
    "@type": "Organization",
    name: "Ekido",
    logo: {
      "@type": "ImageObject",
      url: "https://ekido.id/logo-svg.svg",
    },
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": new URL(Astro.url.pathname, Astro.site).href,
  },
};
---

<Base
  title={title}
  description={description}
  keywords={keywords}
  ogImage={ogImage}
  canonicalUrl={canonicalUrl}
>
  <JsonLd data={jsonLdData} />
  <Navbar />
  <div
    class="bigThumbnail"
    style={`background: url('${post.coverImage?.url}') center/cover no-repeat;`}
  >
    <div class="container">
      <div class="textContainer">
        <div class="blogData">
          <div class="publishDate">{formattedDate}</div>
          <div class="dot">â€¢</div>
          <div class="readingTime">
            {post.readTimeInMinutes} min reading time
          </div>
        </div>
        <div class="blogTitle">{post.title}</div>
      </div>
    </div>
  </div>
  <div class="pageContent">
    <Fragment set:html={post.content.html} />
  </div>
  <About title="Artikel lainnya" />
  <Footer />
</Base>
